<!DOCTYPE html>
<html>
<head>
  <meta http-equiv='content-type' content='text/html;charset=utf8'>
  <meta name='generator' content='Ronn-NG/v0.9.1 (http://github.com/apjanke/ronn-ng/tree/0.9.1)'>
  <title>samba_exporter(1) - part of the samba-exporter package</title>
  <style type='text/css' media='all'>
  /* style: man */
  body#manpage {margin:0}
  .mp {max-width:100ex;padding:0 9ex 1ex 4ex}
  .mp p,.mp pre,.mp ul,.mp ol,.mp dl {margin:0 0 20px 0}
  .mp h2 {margin:10px 0 0 0}
  .mp > p,.mp > pre,.mp > ul,.mp > ol,.mp > dl {margin-left:8ex}
  .mp h3 {margin:0 0 0 4ex}
  .mp dt {margin:0;clear:left}
  .mp dt.flush {float:left;width:8ex}
  .mp dd {margin:0 0 0 9ex}
  .mp h1,.mp h2,.mp h3,.mp h4 {clear:left}
  .mp pre {margin-bottom:20px}
  .mp pre+h2,.mp pre+h3 {margin-top:22px}
  .mp h2+pre,.mp h3+pre {margin-top:5px}
  .mp img {display:block;margin:auto}
  .mp h1.man-title {display:none}
  .mp,.mp code,.mp pre,.mp tt,.mp kbd,.mp samp,.mp h3,.mp h4 {font-family:monospace;font-size:14px;line-height:1.42857142857143}
  .mp h2 {font-size:16px;line-height:1.25}
  .mp h1 {font-size:20px;line-height:2}
  .mp {text-align:justify;background:#fff}
  .mp,.mp code,.mp pre,.mp pre code,.mp tt,.mp kbd,.mp samp {color:#131211}
  .mp h1,.mp h2,.mp h3,.mp h4 {color:#030201}
  .mp u {text-decoration:underline}
  .mp code,.mp strong,.mp b {font-weight:bold;color:#131211}
  .mp em,.mp var {font-style:italic;color:#232221;text-decoration:none}
  .mp a,.mp a:link,.mp a:hover,.mp a code,.mp a pre,.mp a tt,.mp a kbd,.mp a samp {color:#0000ff}
  .mp b.man-ref {font-weight:normal;color:#434241}
  .mp pre {padding:0 4ex}
  .mp pre code {font-weight:normal;color:#434241}
  .mp h2+pre,h3+pre {padding-left:0}
  ol.man-decor,ol.man-decor li {margin:3px 0 10px 0;padding:0;float:left;width:33%;list-style-type:none;text-transform:uppercase;color:#999;letter-spacing:1px}
  ol.man-decor {width:100%}
  ol.man-decor li.tl {text-align:left}
  ol.man-decor li.tc {text-align:center;letter-spacing:4px}
  ol.man-decor li.tr {text-align:right;float:right}
  </style>
</head>
<!--
  The following styles are deprecated and will be removed at some point:
  div#man, div#man ol.man, div#man ol.head, div#man ol.man.

  The .man-page, .man-decor, .man-head, .man-foot, .man-title, and
  .man-navigation should be used instead.
-->
<body id='manpage'>
  <div class='mp' id='man'>

  <div class='man-navigation' style='display:none'>
    <a href="#NAME">NAME</a>
    <a href="#SYNOPSIS">SYNOPSIS</a>
    <a href="#DESCRIPTION">DESCRIPTION</a>
    <a href="#OPTIONS">OPTIONS</a>
    <a href="#EXAMPLES">EXAMPLES</a>
    <a href="#EXPORTED-VALUES">Exported values</a>
    <a href="#SMBD-IN-CLUSTER-MODE">smbd in cluster mode</a>
    <a href="#FILES">Files</a>
    <a href="#BUGS">BUGS</a>
    <a href="#COPYRIGHT">COPYRIGHT</a>
    <a href="#SEE-ALSO">SEE ALSO</a>
  </div>

  <ol class='man-decor man-head man head'>
    <li class='tl'>samba_exporter(1)</li>
    <li class='tc'></li>
    <li class='tr'>samba_exporter(1)</li>
  </ol>

  

<h2 id="NAME">NAME</h2>
<p class="man-name">
  <code>samba_exporter</code> - <span class="man-whatis">part of the samba-exporter package</span>
</p>
<h2 id="SYNOPSIS">SYNOPSIS</h2>

<p><code>samba_exporter</code> <a href="#OPTIONS" title="OPTIONS" data-bare-link="true">options</a></p>

<h2 id="DESCRIPTION">DESCRIPTION</h2>

<p><strong>samba_exporter</strong> The prometheus exporter part of the samba-exporter package.<br></p>

<p>The tool is usually stated as daemon by systemd as <code>samba_exporter.service</code>.<br></p>

<p>It communicates with the <code>samba_statusd.service</code> using the named pipes <code>/run/samba_exporter.request.pipe</code> and <code>/run/samba_exporter.response.pipe</code>.</p>

<h3 id="samba-exporter-package">samba-exporter package</h3>

<p>The <code>samba-exporter package</code> works as a prometheus exporter for statistic data of the samba file server.<br></p>

<p>It uses <code>smbstatus</code> and the <code>proc fs</code> to collect the data and converts the result into prometheus style data.
The prometheus style data can be requested manually on port 9922 using a http client. 
Or a prometheus database sever can be configured to collect the data by scraping port 9922 on the samba server.</p>

<p>The <code>samba-exporter package</code> has two main components running as daemons:</p>

<ul>
  <li>
<code>samba_exporter</code> as prometheus exporter frontend</li>
  <li>
<code>samba_statusd</code> as tool collect the data from samba</li>
</ul>

<p>See <a href="https://imker25.github.io/samba_exporter/UserDocs/Concept/" data-bare-link="true">https://imker25.github.io/samba_exporter/UserDocs/Concept/</a> for more details.</p>

<h2 id="OPTIONS">OPTIONS</h2>

<p>You might want to use one of the following optional parameters.</p>

<ul>
  <li>
    <p><code>-help</code>: 
Print the programs help message and exit</p>
  </li>
  <li>
    <p><code>-log-file-path string</code>:
Give the full file path for a log file. When parameter is not set (as by default), logs will be written to stdout and stderr (default " ")</p>
  </li>
  <li>
    <p><code>-not-expose-client-data</code>
Set to <code>true</code>, no details about the connected clients will be exported</p>
  </li>
  <li>
    <p><code>-not-expose-encryption-data</code>
Set to <code>true</code>, no details about the used encryption or signing will be exported</p>
  </li>
  <li>
    <p><code>-not-expose-user-data</code>
Set to <code>true</code>, no details about the connected users will be exported</p>
  </li>
  <li>
    <p><code>-not-expose-pid-data</code>
    Set to <code>true</code>, no process IDs will be exported</p>
  </li>
  <li>
    <p><code>-not-expose-share-details</code>
    Set to 'true', no details about the shares will be exported</p>
  </li>
  <li>
    <p><code>-print-version</code>:
With this flag the program will only print it's version and exit</p>
  </li>
  <li>
    <p><code>-request-timeout</code>:
The timeout for a request to samba_statusd in seconds (default 5)</p>
  </li>
  <li>
    <p><code>-test-mode</code>:
    Run the program in test mode.<br>
    In this mode the program will always return the same test data. To work with samba_statusd both programs needs to run in test mode or not.</p>
  </li>
  <li>
    <p><code>-test-pipe</code>:
    Requests status from samba_statusd and exits. May be combined with -test-mode.</p>
  </li>
  <li>
    <p><code>-verbose</code>:
    With this flag the program will print verbose output</p>
  </li>
  <li>
    <p><code>-web.listen-address</code>:
    Address to listen on for web interface and telemetry. (default ":9922")<br>
    You might want this to bind to a given ip address like 127.0.0.1 by setting this parameter as "127.0.0.1:9922".
    To use 9123 as port use ":9123" here.</p>
  </li>
  <li>
    <p><code>-web.telemetry-path</code>:
    Path under which to expose metrics. (default "/metrics")</p>
  </li>
</ul>

<p>To change the behavior of the samba_exporter service update the <code>/etc/default/samba_exporter</code> according to your needs. 
You can add any option shown in the help output of <code>samba_exporter</code> to the <code>ARGS</code> variable.<br></p>

<p>You may not want to start the service with arguments that will exit before listening starts like <code>-test-pipe</code>, <code>-help</code> or <code>-print-version</code>.<br>
The service will start with <code>-web.listen-address=127.0.0.1:9922</code> by default, in case your prometheus server is running on a different machine you
need to change this.<br>
<code>/etc/default/samba_exporter</code> includes some examples.</p>

<h2 id="EXAMPLES">EXAMPLES</h2>

<p>To stop, start or restart the service use <code>systemctl</code>, e. g.:<br> 
<code>sudo systemctl stop samba_exporter</code></p>

<p>To read the log output use <code>journalctl</code>, e. g.:<br> 
<code>sudo journalctl -u samba_exporter</code>.<br></p>

<p><strong>Remark:</strong> Due to the services dependencies <code>samba_exporter</code> service stops whenever <code>samba_statusd</code> stops. 
And <code>samba_statusd</code> always starts when <code>samba_exporter</code> is started if not already running.</p>

<h2 id="Exported-values">Exported values</h2>

<p>The following values are exported by default:</p>

<ul>
  <li>
<code>samba_client_connected_at</code> Unix time stamp a client connected</li>
  <li>
<code>samba_client_connected_since_seconds</code> Seconds since a client connected</li>
  <li>
<code>samba_client_count</code> Number of clients using the samba server</li>
  <li>
<code>samba_encryption_method_count</code> Number of processes on the server using the encryption</li>
  <li>
<code>samba_exporter_information</code> Information of the samba_exporter</li>
  <li>
<code>samba_individual_user_count</code> The number of users connected to this samba server</li>
  <li>
<code>samba_lock_created_at</code> Unix time stamp a lock was created</li>
  <li>
<code>samba_lock_created_since_seconds</code> Seconds since a lock was created</li>
  <li>
<code>samba_locked_file_count</code> Number of files locked by the samba server</li>
  <li>
<code>samba_locks_per_share_count</code> Number of locks on share</li>
  <li>
<code>samba_pid_count</code> Number of processes running by the samba server. Only exported when not running in cluster mode.</li>
  <li>
<code>samba_process_per_client_count</code> Number of processes on the server used by one client</li>
  <li>
<code>samba_protocol_version_count</code> Number of processes on the server using the protocol</li>
  <li>
<code>samba_request_time</code> Time it took to reqest the samba status from samba_statusd [ms]</li>
  <li>
<code>samba_satutsd_up</code> 1 if the samba_statusd seems to be running</li>
  <li>
<code>samba_server_information</code> Version of the samba server</li>
  <li>
<code>samba_server_up</code> 1 if the samba server seems to be running</li>
  <li>
<code>samba_share_count</code> Number of shares servered by the samba server</li>
  <li>
<code>samba_signing_method_count</code> Number of processes on the server using the signing</li>
  <li>
<code>samba_smbd_cpu_usage_percentage</code> CPU usage of the 'smbd' process with pid in percent</li>
  <li>
<code>samba_smbd_io_counter_read_bytes</code> IO counter reads of the process 'smbd' in byte</li>
  <li>
<code>samba_smbd_io_counter_read_count</code> IO counter read count of the process 'smbd'</li>
  <li>
<code>samba_smbd_io_counter_write_bytes</code> IO counter writes of the process 'smbd' in byte</li>
  <li>
<code>samba_smbd_io_counter_write_count</code> IO counter write count of the process 'smbd'</li>
  <li>
<code>samba_smbd_open_file_count</code> Open file handles by process 'smbd'</li>
  <li>
<code>samba_smbd_sum_cpu_usage_percentage</code> Sum CPU usage of all 'smbd' processes in percent</li>
  <li>
<code>samba_smbd_sum_io_counter_read_bytes</code> IO counter reads of all 'smbd' processes in bytes</li>
  <li>
<code>samba_smbd_sum_io_counter_read_count</code> IO counter read count of all 'smbd' processes</li>
  <li>
<code>samba_smbd_sum_io_counter_write_bytes</code> IO counter writes of all 'smbd' processes in bytes</li>
  <li>
<code>samba_smbd_sum_io_counter_write_count</code> IO counter write count of all 'smbd' processes</li>
  <li>
<code>samba_smbd_sum_open_file_count</code> Open file handles of all 'smbd' processes</li>
  <li>
<code>samba_smbd_sum_thread_count</code> Threads used by all 'smbd' processes</li>
  <li>
<code>samba_smbd_sum_virtual_memory_usage_bytes</code> Virtual memory usage of all 'smbd' processes in bytes</li>
  <li>
<code>samba_smbd_sum_virtual_memory_usage_percent</code> Virtual memory usage of all 'smbd' processes in percent</li>
  <li>
<code>samba_smbd_thread_count</code> Threads used by process 'smbd'</li>
  <li>
<code>samba_smbd_unique_process_id_count</code> Count of unique process IDs for 'smbd'</li>
  <li>
<code>samba_smbd_virtual_memory_usage_bytes</code> Virtual memory usage of the 'smbd' process with pid in bytes</li>
  <li>
<code>samba_smbd_virtual_memory_usage_percent</code> Virtual memory usage of the 'smbd' process with pid in percent</li>
</ul>

<h2 id="smbd-in-cluster-mode">smbd in cluster mode</h2>

<p>The values of <code>samba_client_*</code> and <code>samba_process_per_client_count</code> may contain no valid data when monitoring a <strong>smbd</strong> running in cluster mode. When running in this mode the values of <code>uid</code> and <code>gid</code> may exported in labels are shown as <code>-1</code> since <code>smbstatus -L</code> gives only anonymous data in this case. Another consequence of this fact is that <code>samba_individual_user_count</code> may show wrong values as well.</p>

<p>But when running in cluster mode the following additional metrics are exported:</p>

<ul>
  <li>
<code>samba_cluster_node_count</code> Number of cluster nodes running the samba cluster</li>
  <li>
<code>samba_pids_per_node_count</code> Number of PIDs per cluster node</li>
  <li>
<code>samba_locks_per_node_count</code> Number of Locks per cluster node</li>
  <li>
<code>samba_processes_per_node_count</code> Number of Locks per cluster node</li>
  <li>
<code>samba_shares_per_node_count</code> Number of Shares per cluster node</li>
</ul>

<h2 id="Files">Files</h2>

<ul>
  <li>
<code>/etc/default/samba_exporter</code> The configuration file for the samba_exporter service</li>
  <li>
<code>/run/samba_exporter.request.pipe</code> The pipe samba_exporter requests the status from samba_statusd</li>
  <li>
<code>/run/samba_exporter.response.pipe</code> The pipe samba_statusd answers requests from samba_exporter</li>
  <li>
<code>/usr/share/doc/samba-exporter/grafana/SambaService.json</code> A example dashboard for Grafana</li>
</ul>

<h2 id="BUGS">BUGS</h2>

<p>See <a href="https://github.com/imker25/samba_exporter/issues" data-bare-link="true">https://github.com/imker25/samba_exporter/issues</a> <br>
In case you found a new bug please also report as github issue on the projects page.</p>

<h3 id="Konwn-issues">Konwn issues</h3>

<ol>
  <li>While <code>samba_exporter</code> can work with files that contains spaces in the path and with shares that contain spaces in the name it can not work with shares that contain spaces in the path.<br>
  <strong>Example:</strong> It is fine to have a share named <code>share with spaces</code>, but it's a problem to export statistics if the shared folder is <code>/srv/shares/with spaces/</code>
</li>
</ol>

<h2 id="COPYRIGHT">COPYRIGHT</h2>

<p>samba_exporter is Copyright (C) 2021 Tobias Zellner <a href="mailto:tobi@backfraki.de" data-bare-link="true">tobi@backfraki.de</a></p>

<h2 id="SEE-ALSO">SEE ALSO</h2>

<p><span class="man-ref">samba_statusd<span class="s">(1)</span></span>, <span class="man-ref">start_samba_statusd<span class="s">(1)</span></span></p>

  <ol class='man-decor man-foot man foot'>
    <li class='tl'></li>
    <li class='tc'>April 2025</li>
    <li class='tr'>samba_exporter(1)</li>
  </ol>

  </div>
</body>
</html>
